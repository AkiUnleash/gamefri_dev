rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /{document=**} {
      allow read: if true;
    }
    function isAnyAuthenticated() {
      return request.auth != null;
    }

    function isUserAuthenticated(userID) {
      return isAnyAuthenticated() && userID == request.auth.uid
    }

    match /user/{userID} {
      allow write, create, update: if isUserAuthenticated(userID)
        && (!('profileid' in request.resource.data) || (request.resource.data.profileid is string && request.resource.data.profileid.size() <= 20))
        && (!('nickname' in request.resource.data) || (request.resource.data.nickname is string && request.resource.data.nickname.size() <= 100))
        && (!('introduction' in request.resource.data) || (request.resource.data.introduction is string && request.resource.data.nickname.size() <= 2000))
        && (!('playgame' in request.resource.data) || (request.resource.data.gender is string))
        && (!('timestart' in request.resource.data) || (request.resource.data.timestart is string))
        && (!('timeend' in request.resource.data) || (request.resource.data.timeend is string))
        && (!('avatarurl' in request.resource.data) || (request.resource.data.avatarurl is string))
        && (!('coverurl' in request.resource.data) || (request.resource.data.coverurl is string))
    }
  }
}